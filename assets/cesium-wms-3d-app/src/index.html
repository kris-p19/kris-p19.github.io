<!DOCTYPE html>
<html>

<head>
    <title>Map Prototype</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <script src="https://unpkg.com/ol@latest/dist/ol.js"></script>
    <link href="https://unpkg.com/ol@latest/ol.css" rel="stylesheet" />

    <script src="https://unpkg.com/ol-cesium@latest/dist/olcesium.js"></script>
    <script src="https://unpkg.com/proj4@2.8.0/dist/proj4.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Cesium.js"></script>
    <style>
        html,
        body,
        #map {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
        #toggle-3d {
            position: absolute;
            top: 10px;
            left: 40px;
            z-index: 1000;
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        #basemap-select {
            position: absolute;
            top: 50px;
            left: 40px;
            z-index: 1000;
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <button id="toggle-3d">Toggle 3D</button>
    <select id="basemap-select">
        <option value="osm">üó∫Ô∏è OpenStreetMap</option>
        <option value="esri">üåé Esri World Imagery</option>
        <option value="google">üõ∞Ô∏è Google Satellite</option>
    </select>

    <div id="map" class="map"></div>
    <script>
        // Register projection (EPSG:4326)
        ol.proj.proj4.register(proj4);
        const proj4326 = ol.proj.get('EPSG:4326');

        // Base layer using OSM
        const osmLayer = new ol.layer.Tile({
            source: new ol.source.OSM()
        });
        const esriLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
                attributions: 'Tiles ¬© Esri'
            }),
            visible: false
        });
        const googleLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
                attributions: 'Map data ¬© Google'
            }),
            visible: false
        });

        // View with EPSG:4326
        const view = new ol.View({
            projection: proj4326,
            center: [100.611793, 7.191323], // LonLat (Bangkok)
            zoom: 10
        });

        const vectorSource = new ol.source.Vector({
            url: 'shoreline_0m4326.geojson', // üîÅ Your file path here
            format: new ol.format.GeoJSON()
        });

        const vectorLayer = new ol.layer.Vector({
            source: vectorSource,
            style: new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: 'red',
                    width: 2
                })
            })
        });

        const map = new ol.Map({
            target: 'map',
            layers: [osmLayer, esriLayer, googleLayer, vectorLayer],
            view: view
        });

        // Enable OL-Cesium 3D
        const ol3d = new olcs.OLCesium({ map: map });
        const scene = ol3d.getCesiumScene();
        scene.globe.depthTestAgainstTerrain = true;
        ol3d.setEnabled(false); // ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î 3D

        // Modify ‡πÄ‡∏™‡πâ‡∏ô
        const modify = new ol.interaction.Modify({ source: vectorSource });
        map.addInteraction(modify);

        document.getElementById('basemap-select').addEventListener('change', function () {
            const selected = this.value;

            osmLayer.setVisible(selected === 'osm');
            esriLayer.setVisible(selected === 'esri');
            googleLayer.setVisible(selected === 'google');
        });


        document.getElementById('toggle-3d').addEventListener('click', function () {
            ol3d.setEnabled(!ol3d.getEnabled());
            this.textContent = ol3d.getEnabled() ? 'Disable 3D' : 'Enable 3D';
        });
    </script>
</body>

</html>